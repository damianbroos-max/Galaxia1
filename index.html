<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Para Andrea わ</title>
    <style>
        /* CSS UNIFICADO */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #020205;
        }

        #galaxy-canvas {
            display: block;
        }

        #ui-container {
            position: absolute;
            bottom: 15%;
            left: 50%;
            transform: translate(-50%);
            text-align: center;
            pointer-events: none;
            z-index: 10;
            width: 100%;
        }

        #message {
            color: white;
            font-family: 'Georgia', serif;
            font-size: clamp(1rem, 4vw, 1.8rem);
	        padding: 0 20px;
            font-style: italic;
            letter-spacing: 4px;
            opacity: 0;
    	    transition: opacity 2s ease, text-shadow 1.5s ease-in-out;
		}
		.glow-active {
			text-shadow: 0 0 20px #ff69b4, 0 0 30px #ff1493, 0 0 40px #ff1493;
        }

        #music-control {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            z-index: 20;
            backdrop-filter: blur(5px);
        }

        #instructions {
            position: fixed;
            top: 20px;
            width: 100%;
            text-align: center;
            color: rgba(255,255,255,0.4);
            font-family: sans-serif;
            font-size: 0.8rem;
            letter-spacing: 2px;
            text-transform: uppercase;
        }
    </style>
</head>
<body>

    <div id="instructions">Desliza hacia arriba</div>

    <div id="ui-container">
        <h1 id="message">Para Andrea, aunque no te ba帽es te quiero ズわ</h1>
    </div>
    
    <button id="music-control"></button>
    
    <audio id="background-music" loop>
        <source src="Hecha_pa_mi-Boza.mp3" type="audio/mpeg">
    </audio>

    <canvas id="galaxy-canvas"></canvas>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>

    <script type="module">
    import * as THREE from 'three';

    // --- CONFIGURACIN GLOBAL ---
    const totalFotos = 11; // Ajusta este n煤mero a tus fotos reales
    const PARTICLE_COUNT = 350; 
    let lerpFactor = 0;
    let targetLerp = 0;

    // 1. Inicializaci贸n de escena y c谩mara
    const scene = new THREE.Scene();
    const isMobile = window.innerWidth < 768;
    const camera = new THREE.PerspectiveCamera(isMobile ? 90 : 75, window.innerWidth / window.innerHeight, 0.1, 2000);
    camera.position.z = isMobile ? 800 : 400;

    const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('galaxy-canvas'), antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);

    // 2. Carga de Texturas
    const loader = new THREE.TextureLoader();
    const texturas = [];
    for (let i = 1; i <= totalFotos; i++) {
        texturas.push(loader.load(`fotos/${i}.jpeg`));
    }

    // 3. Puntos del nombre
    function createTextPoints(text) {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 400;
        canvas.height = 200;
        ctx.fillStyle = 'white';
        ctx.font = 'bold 70px Arial';
        ctx.textAlign = 'center';
		ctx.setTransform(0.8, 0, 0, 1, 0, 0);
        ctx.fillText(text, 200 / 0.8, 100);

        const imageData = ctx.getImageData(0, 0, 400, 200).data;
        const points = [];
        const spacing = isMobile ? 4.5 : 5.0; // Ajuste responsivo del tama帽o del nombre

        for (let y = 0; y < 200; y += 4) {
            for (let x = 0; x < 400; x += 4) {
                if (imageData[(y * 400 + x) * 4] > 128) {
                    points.push(new THREE.Vector3(((x - 200) * spacing) * 0.8, (100 - y) * spacing, 0));
                }
            }
        }
        return points;
    }

    const targetPositions = createTextPoints("Andrea");
    const sprites = new THREE.Group();

    // 4. Creaci贸n de Sprites
    for (let i = 0; i < PARTICLE_COUNT; i++) {
        const mat = new THREE.SpriteMaterial({ 
            map: texturas[i % texturas.length], 
            transparent: true, 
            opacity: 1.0,
            blending: THREE.NormalBlending 
        });
        
        const sprite = new THREE.Sprite(mat);
        // const size = isMobile ? (Math.random() * 5 + 10) : (Math.random() * 10 + 25);
        //sprite.scale.set(size, size, 1);
	    const size = isMobile ? (Math.random() * 8 + 12) : (Math.random() * 10 + 20);
		sprite.scale.set(size, size, 1);
		sprite.userData.baseSize = size; // <--- AGREGA ESTA LNEA para guardar el tama帽o base

        const angle = i * 0.12;
        const radius = 4 * angle;
        sprite.position.set(
            Math.cos(angle) * radius + (Math.random() - 0.5) * 60,
            Math.sin(angle) * radius + (Math.random() - 0.5) * 60,
            (Math.random() - 0.5) * 100
        );

        sprite.userData.origin = sprite.position.clone();
        sprite.userData.target = targetPositions[i % targetPositions.length].clone();
        sprites.add(sprite);
    }
    scene.add(sprites);

    // 5. Estrellas de fondo
    const starGeo = new THREE.BufferGeometry();
    const starPos = [];
    for(let i=0; i<4000; i++) {
        starPos.push((Math.random()-0.5)*2500, (Math.random()-0.5)*2500, -Math.random()*1500);
    }
    starGeo.setAttribute('position', new THREE.Float32BufferAttribute(starPos, 3));
    const starMat = new THREE.PointsMaterial({color: 0xffffff, size: 0.7});
    scene.add(new THREE.Points(starGeo, starMat));

    // 6. Interacci贸n
    const handleInteraction = (delta) => {
        targetLerp = Math.min(Math.max(targetLerp + delta, 0), 1);
        const msg = document.getElementById('message');
        const ins = document.getElementById('instructions');
        if(msg) msg.style.opacity = targetLerp > 0.8 ? "1" : "0";
        if(ins) ins.style.opacity = targetLerp > 0.2 ? "0" : "1";
    };
    
    window.addEventListener('wheel', (e) => handleInteraction(e.deltaY * 0.0008));

    let touchStart = 0;
    window.addEventListener('touchstart', e => { touchStart = e.touches[0].clientY; });
    window.addEventListener('touchmove', e => {
        let delta = (touchStart - e.touches[0].clientY) * 0.008;
        handleInteraction(delta);
        touchStart = e.touches[0].clientY;
    });

    // 7. Animaci贸n
		function animate() {
    requestAnimationFrame(animate);
    if (!scene || !camera || !sprites) return;
    
    const time = Date.now() * 0.001;
    lerpFactor += (targetLerp - lerpFactor) * 0.05;
    const rotationSpeed = 0.002 * (1 - lerpFactor); 
    
    // Calcular el pulso de brillo (solo cuando el nombre est谩 formado)
    // El brillo oscilar谩 entre 0.7 y 1.2
    const pulse = 0.9 + Math.sin(time * 2) * 0.25;

    sprites.children.forEach((sprite, i) => {
        // ... (Tu l贸gica anterior de rotaci贸n y lerp) ...
        sprite.position.lerpVectors(sprite.userData.origin, sprite.userData.target, lerpFactor);

        // APLICAR RESPLANDOR PULSANTE
        if (lerpFactor > 0.9) {
            // Aumentamos la opacidad y el brillo cuando se forma el nombre
            sprite.material.opacity = pulse;
            // Un peque帽o aumento de tama帽o r铆tmico para que "viva"
            const pulseScale = 1 + Math.sin(time * 2 + i) * 0.05;
            sprite.scale.set(
                sprite.userData.baseSize * pulseScale, 
                sprite.userData.baseSize * pulseScale, 
                1
            );
        } else {
            sprite.material.opacity = 0.8;
        }

        sprite.lookAt(camera.position);
    });

    // Control del brillo en el texto del mensaje
    const msg = document.getElementById('message');
    if (targetLerp > 0.9) {
        msg.classList.add('glow-active');
    } else {
        msg.classList.remove('glow-active');
    }
	camera.lookAt(0, 30, 0);
    renderer.render(scene, camera);
    }
    animate();

    // 8. Resize (CORREGIDO)
    window.addEventListener('resize', () => {
        if (camera && renderer) {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
    });

    // 9. M煤sica
    const btn = document.getElementById('music-control');
    const music = document.getElementById('background-music');
    if(btn && music) {
        btn.onclick = () => {
            if(music.paused) { music.play(); btn.innerText = "革"; }
            else { music.pause(); btn.innerText = ""; }
        };
    }
    </script>
</body>

</html>















